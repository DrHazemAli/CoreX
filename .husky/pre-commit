#!/bin/sh

# ============================================================================
# COREX: Pre-Commit Hook
# Runs type checking and linting before allowing commits
# ============================================================================

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo ""
echo "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo "${BLUE}                         COREX PRE-COMMIT CHECKS                         ${NC}"
echo "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

# Step 1: Type Checking
echo "${YELLOW}⏳ Performing TypeScript type check...${NC}"
if npm run typecheck; then
  echo "${GREEN}✓ Type check passed${NC}"
  echo ""
else
  echo ""
  echo "${RED}✗ Type check failed${NC}"
  echo "${RED}Please fix TypeScript errors before committing.${NC}"
  echo ""
  exit 1
fi

# Step 2: Lint Staged Files
echo "${YELLOW}⏳ Linting staged files...${NC}"
if npx lint-staged; then
  echo "${GREEN}✓ Lint check passed${NC}"
  echo ""
else
  echo ""
  echo "${RED}✗ Lint check failed${NC}"
  echo "${RED}Please fix linting errors before committing.${NC}"
  echo ""
  exit 1
fi

# All checks passed
echo "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo "${GREEN}✅ All pre-commit checks passed!${NC}"
echo "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
